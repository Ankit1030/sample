import{a as Z}from"./chunk-DKBDX4DY.js";import"./chunk-DCDAXZPH.js";import{a as K}from"./chunk-NYVMVRXC.js";import{b as A,d as L,f as U,g as B,i as G,k as P,l as j,p as z,q as H,v as q,w as Q,x as W}from"./chunk-WG6S5C63.js";import{j as Y}from"./chunk-PUGHWEAK.js";import{Ab as m,Cc as R,Eb as F,Hb as h,Jb as C,Ob as M,Pb as T,Qb as I,Sb as i,Tb as y,Ua as _,Wb as D,Xa as c,Xb as k,Ya as g,Yb as V,_b as w,ba as S,ea as b,fa as v,mb as f,ob as u,tb as E,wb as x,xb as N,yb as r,zb as t,zc as O}from"./chunk-44JF2HE3.js";var X=["closeButton"];function ee(l,s){l&1&&(r(0,"small",29),i(1,"Country name of min length 1 alphabet is required to search"),t())}var te=(l,s)=>s._id;function oe(l,s){if(l&1&&m(0,"img",37),l&2){let a=C().$implicit;u("src",a.flag,_)}}function ne(l,s){if(l&1&&(r(0,"tr")(1,"td"),i(2),t(),r(3,"td"),i(4),t(),r(5,"td"),i(6),t(),r(7,"td"),f(8,oe,1,1,"img",36),t(),r(9,"td"),i(10),t(),r(11,"td"),i(12),t()()),l&2){let a=s.$implicit;c(2),y(a.cname),c(2),y(a.ccode),c(2),y(a.ccurr),c(2),u("ngIf",a.flag),c(2),y(a.ccallcode),c(2),y(a.tzone)}}function re(l,s){if(l&1){let a=F();r(0,"form",10)(1,"input",30),V("ngModelChange",function(e){b(a);let n=C();return k(n.searchvalue,e)||(n.searchvalue=e),v(e)}),t(),r(2,"button",31),h("click",function(){b(a);let e=C();return v(e.getResult())}),i(3,"Search"),t()(),r(4,"div",32)(5,"div",33)(6,"table",34)(7,"thead")(8,"tr")(9,"th"),i(10,"Country Name"),t(),r(11,"th"),i(12,"Country Code"),t(),r(13,"th"),i(14,"Currency"),t(),r(15,"th"),i(16,"Flag"),t(),r(17,"th"),i(18,"Call Code"),t(),r(19,"th"),i(20,"Time Zone"),t()()(),r(21,"tbody",35),x(22,ne,13,6,"tr",null,te),t()()()()}if(l&2){let a=C();c(),D("ngModel",a.searchvalue),c(),u("disabled",a.disOutSeabtn),c(20),N(a.allcountries)}}var he=(()=>{let s=class s{constructor(o,e,n,d){this.fb=o,this.vs=e,this.toaster=n,this.getservice=d,this.savecountrydisable=!0,this.disable=!0,this.disablesearchbtn=!0,this.searchterm={},this.sterm=""}ngOnInit(){this.countryForm=this.fb.group({countryName:["",[L.required]],currency:[""],countryCode:[""],countryCallingCode:[""]}),this.disableFormControls(),this.getAllcountry({sterm:""})}disableFormControls(){Object.keys(this.countryForm.controls).forEach(o=>{this.countryForm.get(o).disable()})}openform(){this.countryForm.reset(),this.countryForm.get("countryName").enable()}searchdata(){console.log("------------ KEY PRESS --------------------------------------------------------"),this.cname=this.countryForm.get("countryName").value.trim(),console.log(this.cname);let o=this.cname.trim().length;if(o>0)try{this.vs.getcountryname(this.cname,o).subscribe({next:e=>{if(e){this.flag=e.flags.png,this.tzone=e.timezones[0];let n=e;console.log(e);let d=n.name.common,$=Object.keys(n.currencies)[0],p;n.idd.suffixes.length===1?p=n.idd.root+n.idd.suffixes[0]:p=n.idd.root,console.log(p);let J=n.cca2;this.searchedcountryData={countryName:d,currency:$,countryCode:J,countryCallingCode:p},this.countryForm.setValue(this.searchedcountryData),this.countryForm.get("countryName").disable(),this.disablesearchbtn=!0,this.savecountrydisable=!1,console.log(this.countryForm),this.toaster.success("Country Found ","Success")}else this.toaster.error("No Matching Country Found","! invalid Name")},error:e=>{this.toaster.error("Search server Error","!Server error")},complete:()=>{console.log("COMPLETED  GETCOUNTRY ROUTE")}})}catch(e){console.log("CATCH",e)}else return}clearform(){this.countryForm.reset(),this.countryForm.get("countryName").enable(),this.savecountrydisable=!0}searchfield(){if(console.log("Searchfield----"),this.countryForm.get("countryName").value){console.log("SOMETHING ENTERED --*-***-**-"),this.disablesearchbtn=!1;var o=this.countryForm.get("countryName").value.trim();if(o.length==0){this.disablesearchbtn=!0,console.log("value.length == 0");return}if(o.length>>0&&this.previousValue!==o){console.log("CHANGE-- IF--"),this.disablesearchbtn=!1,this.previousValue=o;return}}else console.warn("No VALUE -----"),this.disablesearchbtn=!0}compareObjects(o,e){for(let n of Object.keys(o))if(o[n]!==e[n])return!1;return!0}onSubmit(){if(console.log("this.countryForm.value",this.countryForm.value),console.log("this.searchedcountryData",this.searchedcountryData),!this.compareObjects(this.countryForm.value,this.searchedcountryData)){console.log("inside manipulating the data-->>>>>>>>>>>>>>>>>>"),this.toaster.warning("Dont manipulate the Data ","Read only data"),this.countryForm.setValue(this.searchedcountryData),this.disableFormControls();return}if(console.log("CALLED SUBMIT-----"),!this.countryForm.get("countryName").disabled){this.toaster.error("Please select the Country","Country not selected");return}console.log("--------INSIDE SUBMIT------------------------------"),console.log("cname",this.countryForm.get("countryName").value.trim()),console.log("ccurr",this.countryForm.get("currency").value),console.log("ccode",this.countryForm.get("countryCode").value),console.log("ccallcode",this.countryForm.get("countryCallingCode").value),console.log("--------INSIDE SUBMIT------------------------------");let o={cname:this.searchedcountryData.countryName,ccurr:this.searchedcountryData.currency,ccode:this.searchedcountryData.countryCode,ccallcode:this.searchedcountryData.countryCallingCode,tzone:this.tzone,flag:this.flag};console.log("cdata",o),this.vs.addcountry(o).subscribe({next:e=>{console.log(e),e.success===!0?(this.allcountries.push(e.data),this.closeModal(),this.toaster.success("Country added Successfully to DB","Success")):this.toaster.error("Country not added Error","Error")},error:e=>{console.log("Add new country Error",e),e.status===409?(this.toaster.error(e.error.message,"Duplicate Entry"),console.error("Country data already exists:",e.error.message)):e.status===500?this.toaster.error("Internal Server Error","Error 500"):this.toaster.error(e.message,e.statusText+" "+e.status)},complete:()=>{console.log("Completed send data to addCountry")}})}getResult(){console.log("GET RESULT");let o=this.searchvalue.trim().toLowerCase();if(o.length===0){console.log("null Trim no req"),this.getAllcountry({sterm:""});return}if(this.previousSearchValue!==o){console.log("this.previousSearchValue",this.previousSearchValue),console.log("searchterm",o),console.log("CHANGE-- IF--"),this.previousSearchValue=o,console.warn("NEW PREVIOUS SEARCHVALUE ",this.previousSearchValue),console.log("searchterm--",o);let e={sterm:o};this.getAllcountry(e);return}}getAllcountry(o){this.getservice.getcountry(o).subscribe({next:e=>{console.log(e),e.data===null&&(this.toaster.error("No Matching result found","No result"),this.allcountries=[],console.warn("Search --- COUNTRIES RECEIVED "),console.log(e.data)),this.allcountries=e.data,console.warn("ALL COUNTRIES RECEIVED SUCCESS")},error:e=>{console.log(e),console.log("GET ALL COUNTRIES ERROR--")},complete:()=>{}})}closeModal(){this.closeButton&&this.closeButton.nativeElement&&this.closeButton.nativeElement.click()}};s.\u0275fac=function(e){return new(e||s)(g(q),g(Z),g(Y),g(K))},s.\u0275cmp=S({type:s,selectors:[["app-country"]],viewQuery:function(e,n){if(e&1&&M(X,5),e&2){let d;T(d=I())&&(n.closeButton=d.first)}},standalone:!0,features:[w],decls:45,vars:5,consts:[["type","button","data-bs-toggle","modal","data-bs-target","#addCountryModal",1,"form-control","btn","btn-primary",2,"height","50px","font-size","25px","margin-bottom","-15px",3,"click"],["id","addCountryModal","tabindex","-1","aria-labelledby","addCountryModalLabel","aria-hidden","true",1,"modal","fade"],["addCountryModal",""],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","addCountryModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"mb-3"],["for","countryName",1,"form-label"],["type","text","id","countryName","formControlName","countryName",1,"form-control",3,"ngModelChange"],["class","text-danger"],[1,"row"],[1,"col-6"],["type","button",1,"form-control","btn","btn-success",3,"disabled","click"],["type","button",1,"form-control","btn","btn-dark",3,"click"],[1,"my-2"],["for","currency",1,"form-label"],["type","text","id","currency","formControlName","currency",1,"form-control"],["for","countryCode",1,"form-label"],["type","text","id","countryCode","formControlName","countryCode",1,"form-control"],["for","countryCallingCode",1,"form-label"],["type","text","id","countryCallingCode","formControlName","countryCallingCode",1,"form-control"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["closeButton",""],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"text-danger"],["name","searchvalue","ngModal","","placeholder","Search","aria-label","Search",1,"form-control","my-2",3,"ngModel","ngModelChange"],["type","button",1,"form-control","btn","btn-dark","my-2","my-sm-0",3,"disabled","click"],[1,"table-c"],[1,"responsive"],[1,"table","table-bordered","table-hover","align-middle",2,"text-align","center"],[1,"align-middle"],["style","width: 50px; height:30px;","alt","Flag",3,"src",4,"ngIf"],["alt","Flag",2,"width","50px","height","30px",3,"src"]],template:function(e,n){e&1&&(r(0,"button",0),h("click",function(){return n.openform()}),i(1," + Add Country "),t(),r(2,"div",1,2)(4,"div",3)(5,"div",4)(6,"div",5)(7,"h5",6),i(8,"Add Country"),t(),m(9,"button",7),t(),r(10,"div",8)(11,"form",9)(12,"div",10)(13,"label",11),i(14,"Country Name:"),t(),r(15,"input",12),h("ngModelChange",function(){return n.searchfield()}),t(),f(16,ee,2,0,"small",13),t(),r(17,"div",14)(18,"div",15)(19,"button",16),h("click",function(){return n.searchdata()}),i(20,"Search"),t()(),r(21,"div",15)(22,"button",17),h("click",function(){return n.clearform()}),i(23,"Clear"),t()()(),r(24,"div",18)(25,"label",19),i(26,"Currency:"),t(),m(27,"input",20),t(),r(28,"div",10)(29,"label",21),i(30,"Country Code:"),t(),m(31,"input",22),t(),r(32,"div",10)(33,"label",23),i(34,"Country Calling Code:"),t(),m(35,"input",24),t()()(),r(36,"div",25)(37,"button",26,27),i(39,"Close"),t(),r(40,"button",28),h("click",function(){return n.onSubmit()}),i(41,"Save Country"),t()()()()(),m(42,"br")(43,"br"),f(44,re,24,2)),e&2&&(c(11),u("formGroup",n.countryForm),c(5),E(16,n.disablesearchbtn&&n.countryForm.get("countryName").value==""?16:-1),c(3),u("disabled",n.disablesearchbtn),c(21),u("disabled",n.savecountrydisable),c(4),E(44,n.allcountries?44:-1))},dependencies:[R,O,W,j,A,U,B,z,H,Q,P,G],styles:["th[_ngcontent-%COMP%]{background-color:#497fdb;color:#fff}.table-c[_ngcontent-%COMP%]{overflow-y:auto;max-height:650px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{vertical-align:middle;font-size:18px}"]});let l=s;return l})();export{he as CountryComponent};
