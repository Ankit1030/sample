import{a as P}from"./chunk-I6RNCHF7.js";import{a as j,b as w}from"./chunk-FDRY4WOP.js";import{j as T,l as D}from"./chunk-PUGHWEAK.js";import{Ab as x,Cc as I,Eb as S,Hb as E,Jb as m,Sb as r,Tb as u,Ua as f,Ub as q,Xa as l,Ya as g,_b as A,ba as C,ea as R,fa as v,mb as p,ob as _,tb as b,yb as n,yc as k,zb as i,zc as y}from"./chunk-44JF2HE3.js";function F(c,a){c&1&&r(0," Assigning ")}function O(c,a){c&1&&r(0," Accepted ")}function U(c,a){c&1&&r(0," Arrived ")}function M(c,a){c&1&&r(0," Picked ")}function N(c,a){if(c&1){let s=S();n(0,"button",11),E("click",function(){R(s);let t=m(2),o=t.$implicit,d=t.index,h=m();return v(h.rejectAction(o._id,d))}),r(1,"Reject"),i()}}function V(c,a){if(c&1){let s=S();n(0,"td"),x(1,"img",6),i(),n(2,"td"),r(3),i(),n(4,"td"),r(5),i(),n(6,"td"),r(7),i(),n(8,"td"),r(9),i(),n(10,"td"),r(11),i(),n(12,"td"),r(13),i(),n(14,"td"),r(15),i(),n(16,"td"),r(17),i(),n(18,"td"),x(19,"img",6),i(),n(20,"td")(21,"div",7),p(22,F,1,0)(23,O,1,0)(24,U,1,0)(25,M,1,0),i()(),n(26,"td")(27,"div",8)(28,"button",9),E("click",function(){R(s);let t=m(),o=t.$implicit,d=t.index,h=m();return v(h.acceptAction(o._id,o.driverDetails._id,d))}),r(29," Accept "),i(),p(30,N,2,0,"button",10),i()()}if(c&2){let s=m().$implicit,e=m(),t;l(),_("src",e.backendUrl+"/uploads/allusers/"+s.userDetails.uimage,f)("alt",s.userDetails.uname),l(2),u(s.userDetails.uname),l(2),u(s.userDetails.uphone),l(2),u(s.driverDetails.dname),l(2),u(s.driverDetails.dphone),l(2),u(s.bookTime),l(2),u(s.fromLocation),l(2),u(s.toLocation),l(2),u(s.vehicleDetails.vname),l(2),_("src",e.backendUrl+"/uploads/vehicles/"+s.vehicleDetails.vimage,f)("alt",s.vehicleDetails.vname),l(3),b(22,(t=s.ridestatus)===1?22:t===3?23:t===4?24:t===5?25:-1),l(8),_("ngIf",s.ridestatus===1)}}function $(c,a){if(c&1&&(n(0,"tr",5),p(1,V,31,14),i()),c&2){let s=a.$implicit;l(),b(1,s.driverDetails&&s.ridestatus!==7?1:-1)}}var W=(()=>{let a=class a{constructor(e,t,o,d){this.socketService=e,this.runningRequestService=t,this._notificationService=o,this.toaster=d,this.mybackendUrl=D.backendUrl}get backendUrl(){return this.mybackendUrl}ngOnInit(){this.rejectRide(),this.acceptRide(),this.noDriverFound(),this.HoldRide(),this.AssignDriverChrone(),this.getcurrentRunningRequest(),this.getApprovalTime(),this.getAllRunningRequest()}getBackgroundClass(e){switch(e){case 0:return"bg-yellow";case 1:return"bg-orange";case 2:return"bg-green";case 3:return"bg-blue";case 4:return"bg-pink";default:return"bg-dark"}}AssignDriverChrone(){this.socketService.listen("AssignDriverCrone").subscribe({next:e=>{console.log("AssignDriverCrone-->",e);let t=this.findmyIndex(e._id);t!==-1?this.allRequestsArray[t]=e:this.allRequestsArray.push(e)}})}noDriverFound(){this.socketService.listen("NoDriverFound").subscribe({next:e=>{console.log("noDriverFound eventt",e);let t=e.data;localStorage.setItem("Notification_counter",e.counter),this._notificationService.changeDashboardProperty(1);let o=this.findmyIndex(t._id);o!==-1&&this.allRequestsArray.splice(o,1)}})}findmyIndex(e){return this.allRequestsArray.findIndex(o=>o._id===e)}acceptRide(){this.socketService.listen("acceptRide").subscribe({next:e=>{let t=this.findmyIndex(e._id);this.allRequestsArray.splice(t,1)}})}HoldRide(){this.socketService.listen("HoldRide").subscribe({next:e=>{let t=this.findmyIndex(e._id);t!==-1&&this.allRequestsArray.splice(t,1)}})}getcurrentRunningRequest(){this.socketService.listen("getcurrentRunningRequest").subscribe({next:e=>{console.log("EMITTED getcurrentRunningRequest RES",e),this.allRequestsArray.push(e)},error:e=>{console.log("Error getcurrentRunningRequest",e)},complete:()=>{}})}getAllRunningRequest(){this.runningRequestService.getAllRunningRequests("/getAllRunningRequests").subscribe({next:e=>{console.log("response getAllRunningRequests",e),e.success===!0&&(this.allRequestsArray=e.data)},error:e=>{console.log("Erro /getAllRunningRequests",e)},complete:()=>{}})}acceptAction(e,t,o){this.runningRequestService.acceptThisRequest("/acceptRide",e,t).subscribe({next:d=>{console.log("acceptThisRequest RES",d),d.success===!0?this.toaster.success(d.message,"Success"):this.toaster.error(d.message,"Error")},error:d=>{console.log("acceptThisRequest Error",d),this.toaster.error("FAILED TO ACCEPT RIDE error","Error")},complete:()=>{}})}rejectAction(e,t){this.runningRequestService.rejectThisRequest("/rejectRequest",e).subscribe({next:o=>{console.log("rejectRequest RES",o),o.success===!0||this.toaster.error(o.message,"Error")},error:o=>{console.log("Error rejectRequest",o),this.toaster.error("Internal server Error","Error")},complete:()=>{}})}updateRidestatus(){this.socketService.listen("updateRideStatus").subscribe({next:e=>{console.log("updateRideStatus EVENT",e);let t=this.findmyIndex(e._id);e.ridestatus===3&&this.allRequestsArray.splice(t,1)},error:e=>{console.log("acceupdateRideStatus",e)},complete:()=>{}})}getApprovalTime(){this.runningRequestService.getApprovalTime().subscribe({next:e=>{e.success===!0&&(this.Timeout=e.data)},error:e=>{console.log("getApprovalTime Error",e)},complete:()=>{}})}rejectRide(){this.socketService.listen("rejectRide").subscribe({next:e=>{let t=this.findmyIndex(e._id);this.allRequestsArray.splice(t,1)}})}};a.\u0275fac=function(t){return new(t||a)(g(w),g(P),g(j),g(T))},a.\u0275cmp=C({type:a,selectors:[["app-running-request"]],standalone:!0,features:[A],decls:33,vars:2,consts:[[1,"container-fluid"],[1,"fs-4","fw-bolder","text-info","text-center","m-3"],[1,"table","table-responsive","table-bordered","table-striped","align-middle","w-100"],[1,"table-dark","fs-5"],["class","text-center",4,"ngFor","ngForOf"],[1,"text-center"],[2,"max-height","60px",3,"src","alt"],[1,"p-2","bg-secondary","rounded-3","text-white"],[1,"d-flex","gap-2","justify-content-start"],[1,"btn","btn-success",3,"click"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-danger",3,"click"]],template:function(t,o){t&1&&(n(0,"div",0)(1,"div",1),r(2),i(),n(3,"table",2)(4,"thead",3)(5,"tr")(6,"th"),r(7,"User Profile"),i(),n(8,"th"),r(9,"Username"),i(),n(10,"th"),r(11,"User Phone"),i(),n(12,"th"),r(13,"Driver Name"),i(),n(14,"th"),r(15,"Driver Phone"),i(),n(16,"th"),r(17,"Book Time"),i(),n(18,"th"),r(19,"Pickup Address"),i(),n(20,"th"),r(21,"Drop-off Address"),i(),n(22,"th"),r(23,"Service Type"),i(),n(24,"th"),r(25,"Service Image"),i(),n(26,"th"),r(27,"Status"),i(),n(28,"th"),r(29,"Action"),i()(),x(30,"tr"),i(),n(31,"tbody"),p(32,$,2,1,"tr",4),i()()()),t&2&&(l(2),q("Timeout : ",o.Timeout," seconds"),l(30),_("ngForOf",o.allRequestsArray))},dependencies:[I,k,y],styles:[".bg-yellow[_ngcontent-%COMP%]{background-color:#ff0}.bg-orange[_ngcontent-%COMP%]{background-color:#df9919}.bg-green[_ngcontent-%COMP%]{background-color:green}.bg-blue[_ngcontent-%COMP%]{background-color:#00f}.bg-pink[_ngcontent-%COMP%]{background-color:#cc3d55}th[_ngcontent-%COMP%]{padding:20px}"]});let c=a;return c})();export{W as RunningRequestComponent};
